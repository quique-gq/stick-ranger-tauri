!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tauri=t():e.tauri=t()}(this,(function(){return(()=>{"use strict";var e={816:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{o(r.next(e))}catch(e){i(e)}}function u(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}o((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((a=(a=s.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.update=t.install=void 0;var u=n(71),o=n(743),l=n(786),c=s(n(976)),p=n(123),f=n(747),d=s(n(621)),v=s(n(39)),h=c.default("dependency:crates"),y=["tauri"];function g(e){if(f.existsSync(e)){var t=f.readFileSync(e).toString();return d.default.parse(t)}return null}function m(e){return{version:e.substring(0,e.lastIndexOf("."))}}function w(e){return r(this,void 0,void 0,(function(){var t,n,r,s,c,w,_,b,x,M;return a(this,(function(D){switch(D.label){case 0:if(t=[],n=[],r=new Map,null===(s=g(p.resolve.tauri("Cargo.toml"))))return h("Cargo.toml not found. Skipping crates check..."),[2,r];c=p.resolve.tauri("Cargo.lock"),f.existsSync(c)||u.spawnSync("cargo",["generate-lockfile"],p.tauriDir),w=g(c),_=function(r){var i,u,c,p;return a(this,(function(a){switch(a.label){case 0:return i=w?w.package.filter((function(e){return e.name===r})):[],u=s.dependencies[r],void 0!==(c=1===i.length?i[0].version:"string"==typeof u?u:null==u?void 0:u.version)?[3,1]:(h("Installing "+r+"..."),null!==(p=l.getCrateLatestVersion(r))&&(s.dependencies[r]=m(p)),t.push(r),[3,6]);case 1:return e!==o.ManagementType.Update?[3,5]:(p=l.getCrateLatestVersion(r),console.log(r,c,p),null!==p&&l.semverLt(c,p)?[4,v.default.prompt([{type:"confirm",name:"answer",message:'[CRATES] "'+r+'" latest version is '+p+". Do you want to update?",default:!1}])]:[3,3]);case 2:return a.sent().answer&&(h("Updating "+r+"..."),s.dependencies[r]=m(p),n.push(r)),[3,4];case 3:h('"'+r+'" is up to date'),a.label=4;case 4:return[3,6];case 5:h('"'+r+'" is already installed'),a.label=6;case 6:return[2]}}))},b=0,x=y,D.label=1;case 1:return b<x.length?(M=x[b],[5,_(M)]):[3,4];case 2:D.sent(),D.label=3;case 3:return b++,[3,1];case 4:return(t.length||n.length)&&f.writeFileSync(p.resolve.tauri("Cargo.toml"),d.default.stringify(s)),n.length&&(f.existsSync(p.resolve.tauri("Cargo.lock"))||u.spawnSync("cargo",["generate-lockfile"],p.tauriDir),u.spawnSync("cargo",i(["update","--aggressive"],n.reduce((function(e,t){return i(i([],e),["-p",t])}),[])),p.tauriDir)),r.set(o.ManagementType.Install,t),r.set(o.ManagementType.Update,n),[2,r]}}))}))}t.install=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,w(o.ManagementType.Install)];case 1:return[2,e.sent()]}}))}))},t.update=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,w(o.ManagementType.Update)];case 1:return[2,e.sent()]}}))}))}},559:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{o(r.next(e))}catch(e){i(e)}}function u(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}o((r=r.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var n,r,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((a=(a=s.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=o(n(976)),c=i(n(55)),p=i(n(816)),f=i(n(503)),d=l.default("dependency:manager");e.exports={installDependencies:function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return d("Installing missing dependencies..."),c.install(),[4,p.install()];case 1:return e.sent(),[4,f.install()];case 2:return e.sent(),[2]}}))}))},updateDependencies:function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return d("Updating dependencies..."),c.update(),[4,p.update()];case 1:return e.sent(),[4,f.update()];case 2:return e.sent(),[2]}}))}))}}},503:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{o(r.next(e))}catch(e){i(e)}}function u(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}o((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((a=(a=s.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.update=t.installTheseDev=t.installThese=t.install=void 0;var s=n(743),u=n(786),o=i(n(976)),l=n(123),c=i(n(39)),p=n(747),f=n(793),d=o.default("dependency:npm-packages");function v(e,t){var n,i;return r(this,void 0,void 0,(function(){var r,o,v,h,y,g,m,w,_,b,x;return a(this,(function(a){switch(a.label){case 0:if(r=[],o=[],v=f.sync("npm",["--version"]),h=f.sync("yarn",["--version"]),(null!==(n=v.status)&&void 0!==n?n:v.error)&&(null!==(i=h.status)&&void 0!==i?i:h.error))throw new Error("must have `npm` or `yarn` installed to manage dependenices");if(!p.existsSync(l.resolve.app("package.json")))return[3,10];y=0,g=t,a.label=1;case 1:return y<g.length?(m=g[y],null!==(w=u.getNpmPackageVersion(m))?[3,4]:(d("Installing "+m+"..."),e!==s.ManagementType.Install&&e!==s.ManagementType.InstallDev?[3,3]:(_=u.useYarn()?"YARN":"NPM",[4,c.default.prompt([{type:"confirm",name:"answer",message:"["+_+']: "Do you want to install '+m+" "+(e===s.ManagementType.InstallDev?"as dev-dependency":"")+'?"',default:!1}])]))):[3,10];case 2:a.sent().answer&&(e===s.ManagementType.Install?u.installNpmPackage(m):e===s.ManagementType.InstallDev&&u.installNpmDevPackage(m),r.push(m)),a.label=3;case 3:return[3,9];case 4:return e!==s.ManagementType.Update?[3,8]:(b=u.getNpmLatestVersion(m),u.semverLt(w,b)?[4,c.default.prompt([{type:"confirm",name:"answer",message:'[NPM]: "'+m+'" latest version is '+b+". Do you want to update?",default:!1}])]:[3,6]);case 5:return a.sent().answer&&(d("Updating "+m+"..."),u.updateNpmPackage(m),o.push(m)),[3,7];case 6:d('"'+m+'" is up to date'),a.label=7;case 7:return[3,9];case 8:d('"'+m+'" is already installed'),a.label=9;case 9:return y++,[3,1];case 10:return(x=new Map).set(s.ManagementType.Install,r),x.set(s.ManagementType.Update,o),[2,x]}}))}))}var h=["@tauri-apps/api","@tauri-apps/cli"];t.install=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,v(s.ManagementType.Install,h)];case 1:return[2,e.sent()]}}))}))},t.installThese=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,v(s.ManagementType.Install,e)];case 1:return[2,t.sent()]}}))}))},t.installTheseDev=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,v(s.ManagementType.InstallDev,e)];case 1:return[2,t.sent()]}}))}))},t.update=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,v(s.ManagementType.Update,h)];case 1:return[2,e.sent()]}}))}))}},55:function(e,t,n){this&&this.__awaiter,this&&this.__generator;var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.update=t.install=void 0;var a=n(743),i=n(71),s=r(n(375)),u=r(n(976)),o=(n(747),n(622)),l=n(87),c=(r(n(211)),u.default("dependency:rust"));function p(e){null===s.default("rustup")&&(c("Installing rustup..."),"win32"===l.platform()?i.spawnSync("powershell",[o.resolve(__dirname,"../../scripts/rustup-init.exe")],process.cwd()):i.spawnSync("/bin/sh",[o.resolve(__dirname,"../../scripts/rustup-init.sh")],process.cwd())),e===a.ManagementType.Update&&i.spawnSync("rustup",["update"],process.cwd())}t.install=function(){return p(a.ManagementType.Install)},t.update=function(){return p(a.ManagementType.Update)}},743:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ManagementType=void 0,(n=t.ManagementType||(t.ManagementType={}))[n.Install=0]="Install",n[n.InstallDev=1]="InstallDev",n[n.Update=2]="Update"},786:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.semverLt=t.padVersion=t.updateNpmPackage=t.installNpmDevPackage=t.installNpmPackage=t.getNpmPackageVersion=t.getNpmLatestVersion=t.getCrateLatestVersion=t.useYarn=void 0;var a=n(71),i=n(793),s=n(123),u=n(747),o=r(n(513)),l=function(){return process.env.npm_execpath?process.env.npm_execpath.includes("yarn"):u.existsSync(s.resolve.app("yarn.lock"))};function c(e){for(var t,n=(null!==(t=e.match(/\./g))&&void 0!==t?t:[]).length;n<2;)n++,e+=".0";return e}t.useYarn=l,t.getCrateLatestVersion=function(e){var t=i.sync("cargo",["search",e,"--limit","1"]),n=String(t.output[1]),r=new RegExp(e+' = "(\\S+)"',"g").exec(n);return(null==r?void 0:r[1])?r[1]:null},t.getNpmLatestVersion=function(e){if(l()){var t=i.sync("yarn",["info",e,"versions","--json"],{cwd:s.appDir}),n=String(t.output[1]),r=JSON.parse(n);return r.data[r.data.length-1]}return t=i.sync("npm",["show",e,"version"],{cwd:s.appDir}),String(t.output[1]).replace("\n","")},t.getNpmPackageVersion=function(e){var t=l()?i.sync("yarn",["list","--pattern",e,"--depth","0"],{cwd:s.appDir}):i.sync("npm",["list",e,"version","--depth","0"],{cwd:s.appDir}),n=String(t.output[1]),r=new RegExp(e+"@(\\S+)","g").exec(n);return(null==r?void 0:r[1])?r[1]:null},t.installNpmPackage=function(e){l()?a.spawnSync("yarn",["add",e],s.appDir):a.spawnSync("npm",["install",e],s.appDir)},t.installNpmDevPackage=function(e){l()?a.spawnSync("yarn",["add",e,"--dev"],s.appDir):a.spawnSync("npm",["install",e,"--save-dev"],s.appDir)},t.updateNpmPackage=function(e){l()?a.spawnSync("yarn",["upgrade",e,"--latest"],s.appDir):a.spawnSync("npm",["install",e+"@latest"],s.appDir)},t.padVersion=c,t.semverLt=function(e,t){return o.default.lt(c(e),c(t))}},123:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=t.tauriDir=t.appDir=void 0;var a=n(747),i=n(622),s=r(n(976)),u=r(n(242)),o=s.default("tauri",u.default.red);function l(e,t){return t&&i.isAbsolute(t)?t:i.resolve(e,t)}var c=function(){for(var e=process.cwd(),t=0;e.length>0&&!e.endsWith(i.sep)&&t<=2;){if(a.existsSync(i.join(e,"src-tauri","tauri.conf.json")))return e;t++,e=i.normalize(i.join(e,".."))}o("Couldn't find recognize the current folder as a part of a Tauri project"),process.exit(1)}();t.appDir=c;var p=i.resolve(c,"src-tauri");t.tauriDir=p;var f={app:function(e){return l(c,e)},tauri:function(e){return l(p,e)}};t.resolve=f},375:function(e,t,n){var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(793);t.default=function(e,t){void 0===t&&(t=[]);try{var n=a.sync(e,r(r([],t),["--version"]));return 0===n.status?String(n.output[1]).replace(/\n/g,""):null}catch(e){return null}}},976:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a,i=r(n(242)),s=r(n(517));t.default=function(e,t){return void 0===t&&(t=i.default.green),function(n){var r=+new Date,u=r-(a||r);a=r,n?console.log(" "+t(String(e))+" "+n+" "+i.default.green("+"+s.default(u))):console.log()}}},71:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.spawnSync=t.spawn=void 0;var a=r(n(793)),i=r(n(976)),s=r(n(242)),u=i.default("app:spawn"),o=i.default("app:spawn",s.default.red);t.spawn=function(e,t,n,r){u('Running "'+e+" "+t.join(" ")+'"'),u();var i=a.default(e,t,{stdio:"inherit",cwd:n,env:process.env});return i.on("close",(function(t){u(),t&&u('Command "'+e+'" failed with exit code: '+t),r&&r(null!=t?t:0,i.pid)})),i.pid},t.spawnSync=function(e,t,n,r){u('[sync] Running "'+e+" "+t.join(" ")+'"'),u();var i=a.default.sync(e,t,{stdio:"inherit",cwd:n});(i.status||i.error)&&(o(),o('⚠️  Command "'+e+'" failed with exit code: '+i.status),null===i.status&&o('⚠️  Please globally install "'+e+'"'),r&&r(),process.exit(1))}},621:e=>{e.exports=require("@tauri-apps/toml")},242:e=>{e.exports=require("chalk")},793:e=>{e.exports=require("cross-spawn")},747:e=>{e.exports=require("fs")},211:e=>{e.exports=require("https")},39:e=>{e.exports=require("inquirer")},517:e=>{e.exports=require("ms")},87:e=>{e.exports=require("os")},622:e=>{e.exports=require("path")},513:e=>{e.exports=require("semver")}},t={};return function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(559)})()}));
//# sourceMappingURL=dependency-manager.js.map